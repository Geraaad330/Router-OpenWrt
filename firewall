
# Konfiguracja vlan 70 (tylko dla urzadzen wifi)
config zone
	option name 'guest_wifi'
	option input 'REJECT'        # Ruch wchodzacy do routera. uzytkownicy nie moga polaczyc sie z routerem.
	option output 'ACCEPT'       # Ruch wychodzacy z routera. Router moze odpowiadac na zapytania .
	option forward 'REJECT'      # Router nie pozwala na przesylanie danych pomiedzy urzadzaniami w tej strefie lub z tej strefy do innych stref.. Uzytkownicy nie moga widziec innych podsieci.
	option log '1'               # Wlacza logowanie zablokowanych pakietow. 
	option log_limit '10/minute' # Zabezpieczenie, zeby logi nie zapchaly pamieci routera.
	list network 'wifi_vlan70'   # Przypisuje do tej strefu interfejs sieciowy o nazwie wifi_vlan70.


# Pozwala na ruch z vlanu 70 (guest_wifi) do sieci wan, czyli do internetu
config forwarding
	option src 'guest_wifi'
	option dest 'wan'


# Pozwala urzadzeniom z sieci 'guest_wifi' wyslac prosbe na port 67 (UDP) routera.
# Router odpowiada i przydziela adres IP urzadzeniom z tej sieci.
config rule
	option name 'Allow-DHCP-Guest'
	list proto 'udp'
	option dest_port '67'
	option target 'ACCEPT'
	option src 'guest_wifi'


# Pozwala urzadzeniom z sieci 'guest_wifi' pytac router na porcie 53 o adresy stron internetowych.
# udostepnianie uslugi DNS (tlumaczenia nazw domen na adresy IP).
config rule
	option name 'Allow-DNS-Guest'
	option dest_port '53'
	option target 'ACCEPT'
	option src 'guest_wifi'


# Konfiguracja vlan 60
config zone
	option name 'lan60'
	option output 'ACCEPT'  # Router może wysyłac pakiety do urzadzen w sieci
	option forward 'REJECT' # Domyslnie blokuje przesyłanie ruchu przez te strefe. Zapewnia izolację od glownej sieci.
	list network 'lan60'    # Przypisuje do tej strefy interfejs sieciowy o nazwie lan60.
	option input 'REJECT'   # Blokuje ruch przychodzacy do samego routera z tej sieci. Urzadzenia z tej sieci nie moga zalogowac sie do panelu administratora i przez SSH

# Pozwala na ruch z vlanu vlan60 (src) do sieci wan (dest) - czyli internetu.
# Dzieki temu urzadzenia maja internet, ale nie widza innych sieci lokalnych.
config forwarding
	option src 'lan60' 
	option dest 'wan'


config rule
	option name 'Allow-DNS-lan60'
	option src 'lan60'
	option dest_port '53'
	option target 'ACCEPT'


config rule
	option name 'Allow-DHCP-lan60'
	list proto 'udp'
	option src 'lan60'
	option dest_port '67'
	option target 'ACCEPT'



# Ten fragment kodu definiuje, jak router ma traktowac ruch przychodzacy z sieci VPN NetBrd.

config zone
	option name 'netbirdzone'
	option input 'ACCEPT'     # Kazdy, kto jest w sieci NetBird ma prawo laczyc sie z routerem.
	option output 'ACCEPT'    # Pozwala routerowi wysylanie danych do tunelu NetBird.
	option forward 'REJECT'   # Domyslnie zabrania ruchowi z NetBirda przechodzenia dalej do innych stref. 
	option masq '1'           # Wlacza NAT dla ruchu z VPN. Dzieki temu urzadzenia w LAN widza ruch z VPN tak, jakby pochodzil od routera (z jego lokalnego IP). Bez tego urzadzenia w LAN moglby nie wiedziec, jka odpisac do NetBirda.
	list network 'netbird'
	option mtu_fix '1'        # Zapobiega problemom z ladowaniem stron przez VPN (dopoasowuje wielkosc pakietow do tunelu).


# Pozwala polaczyc sie z urzadzeniami w domu, bedac poza siecia LAN.

config forwarding
	option src 'netbirdzone'
	option dest 'lan'


# Pozwala uzywac routera jako 'Exit Node'. Bedac poza siecia LAN, ruch jest zaszyfrowany tunelem do domu,
# a potem wychodzidomowym laczem do internetu.

config forwarding
	option src 'netbirdzone'
	option dest 'wan'


# Pozwala urzadzeniom w w sieci LAN zainicjowac polaczenie do urzadzenia zdalnego, jesli to urzadzenie jest dostepny w sieci NetBird.

config forwarding
	option src 'lan'
	option dest 'netbirdzone'


# Pozwala urzadzeniom z glownej sieci wyslac plik do drukarki, ktora jest odizolowana w sieci lan60.

config rule
	option name 'Allow-VLAN50-to-Printer' 
	option src 'lan'                       # Glowna siec.
	option dest 'lan60'                    # Siec izolowana (gdzie jest drukarka).
	list dest_ip '192.168.x.x'             # IP drukarki.
	option target 'ACCEPT'                 # Zezwol.


# Pozwala urzadzeniom z sieci vln70 (guest_wifi) wyslac plik do drukarki, ktora jest odizolowana w sieci lan60.

config rule
	option name 'Allow-VLAN70-to-Printer'
	option src 'guest_wifi'                # Siec guest_wifi.
	option dest 'lan60'                    # Siec izolowana (gdzie jest drukarka).
	list dest_ip '192.168.x.x'             # IP drukarki.
	option target 'ACCEPT'                 # Zezwol.

